<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sfChart="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts"  
             x:Class="RunPlan.Model.MainPage"
             xmlns:viewModel="clr-namespace:RunPlan.ViewModel"
             BackgroundColor="#8260DA">

    <ScrollView>

        <VerticalStackLayout Padding="20,0" Spacing="-20">

            <!-- Header with app name and profile icon -->
            <Grid Padding="20" ColumnDefinitions="*,Auto" VerticalOptions="Start">
                <Label Text="Hiya Soldier!"
                       FontSize="32"
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center" />
                <Image Source="logo_nobackground.png"
                       HeightRequest="150"
                       WidthRequest="150"
                       VerticalOptions="End"
                       HorizontalOptions="End"
                       Aspect="AspectFill" />
            </Grid>

            <!-- Summary Cards Section -->
            <VerticalStackLayout Spacing="10">

                <!-- Last Activity Card -->
                <Border BackgroundColor="#4E3689"
                        StrokeShape="RoundRectangle 20"
                        Padding="15"
                        HorizontalOptions="Fill"
                        Stroke="#4E3689">
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          RowDefinitions="Auto,Auto"
                          ColumnSpacing="10">

                        <!-- Icon -->
                        <Image Source="pin_white.png" 
                               HeightRequest="40"
                               WidthRequest="40"
                               Grid.RowSpan="2" 
                               Grid.Column="0" 
                               VerticalOptions="Center" />

                        <!-- Title -->
                        <Label Text="Last Activity"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="White"
                               Grid.Column="1"
                               Grid.Row="0"
                               Grid.ColumnSpan="2" />

                        <!-- Run name -->
                        <Label x:Name="LastActivityName"
                               Text="{Binding LastActivity.Name}"
                               TextColor="White"
                               Grid.Row="1"
                               Grid.Column="1" />

                        <!-- Run time + pace in same row -->
                        <StackLayout Orientation="Horizontal"
                                     HorizontalOptions="End"
                                     Grid.Row="1"
                                     Grid.Column="2"
                                     Spacing="15">
                            <Label x:Name="LastActivityPace"
                                   Text="{Binding LastActivityPace}"
                                   TextColor="White" />
                            <Label x:Name="LastActivityTime"
                                   Text="{Binding LastActivity.Time}"
                                   TextColor="White" />
                            <Label x:Name="LastActivityDistance"
                                   Text="{Binding LastActivity.Distance, StringFormat='{}{0} km'}"
                                   TextColor="White" />
                        </StackLayout>
                    </Grid>
                </Border>


                <!-- Weekly Summary Card -->
                <Border BackgroundColor="#4E3689"
                        StrokeShape="RoundRectangle 20"
                        Padding="15"
                        HorizontalOptions="Fill"
                        Stroke="#4E3689">
                    <Grid ColumnDefinitions="Auto,*,Auto"
                          RowDefinitions="Auto,Auto"
                          ColumnSpacing="10">

                        <!-- ✅ Circular Image Wrapper -->
                        <Border StrokeShape="Ellipse"
                            HeightRequest="50"
                            WidthRequest="50"
                            Padding="0"
                            Grid.RowSpan="2"
                            Grid.Column="0"
                            VerticalOptions="Center"
                            HorizontalOptions="Start"
                            BackgroundColor="Transparent"
                                Stroke="Transparent">
                            <Image Source="https://i.etsystatic.com/5661443/r/il/12424b/5227674592/il_1588xN.5227674592_216p.jpg"
                                   Aspect="AspectFill" 
                                  />
                        </Border>

                        <Label Text="This Week"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="White"
                               Grid.Column="1"
                               Grid.ColumnSpan="2" />

                        <Label x:Name="WeekActivityDistance"
                               Text="{Binding ThisWeekDistance}"
                               TextColor="White"
                               Grid.Row="1"
                               Grid.Column="1" />

                        <Label x:Name="WeekActivityHours"
                               Text="{Binding ThisWeekTime}"
                               TextColor="White"
                               Grid.Row="1"
                               Grid.Column="2" />

                    </Grid>
                </Border>
                <!-- Logout button-->
                <HorizontalStackLayout HorizontalOptions="Center" Margin="0,20,0,10">
                    <Button Text="Logout"
                                               Command="{Binding LogoutCommand}"
                                               BackgroundColor="White"
                                               TextColor="#7B61FF"
                                               BorderColor="#7B61FF"
                                               BorderWidth="2"
                                               FontAttributes="Bold"
                                               CornerRadius="20"
                                               WidthRequest="200"
                                               HeightRequest="50"/>
                </HorizontalStackLayout>


                <BoxView HeightRequest="30" Opacity="0" />


            </VerticalStackLayout>



            <!-- Weekly Running Distance Graph -->
            <Border BackgroundColor="#6346AF"
                    Padding="10"
                    StrokeShape="RoundRectangle 20"
                    HorizontalOptions="Fill"
                    VerticalOptions="Fill"
                    Stroke="#6246AF">

                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.5" Offset="5,5" />
                </Border.Shadow>

                <Grid RowDefinitions="Auto, Auto, *, Auto"
                      ColumnDefinitions="*"
                      RowSpacing="15"
                      ColumnSpacing="0"
                      Padding="0,10,0,0">

                    <!-- Chart Title -->
                    <Label Text="Three Months Overview"
                           FontAttributes="Bold"
                           FontSize="30"
                           TextColor="White"
                           HorizontalOptions="Center"
                           Padding="13"
                           Grid.Row="0" />

                    <!-- ⬆️ Move the Tooltip above the chart -->
                    <StackLayout x:Name="TooltipPanel"
                                 IsVisible="False"
                                 Margin="40,0,0,0"
                                 Spacing="6"
                                 Grid.Row="1"
                                 Orientation="Vertical"
                                 HorizontalOptions="Fill"
                                 VerticalOptions="Start">


                        <!-- Week Label -->
                        <Label x:Name="TooltipWeek"
                               Text="Week"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="White" />

                        <!-- Labels Row -->
                        <Grid ColumnSpacing="30">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Label Text="Distance"
                               TextColor="White"
                               FontAttributes="Bold"
                               Grid.Column="0" />
                            <Label Text="Time"
                               TextColor="White"
                               FontAttributes="Bold"
                               Grid.Column="1" />
                        </Grid>

                        <!-- Values Row -->
                        <Grid ColumnSpacing="50">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Label x:Name="TooltipDistance"
                               Text="0 km"
                               TextColor="White"
                               Grid.Column="0" />
                            <Label x:Name="TooltipTime"
                       Text="0:00"
                       TextColor="White"
                       Grid.Column="1" />
                        </Grid>


                    </StackLayout>



                    <!-- Chart Itself -->
                    <GraphicsView x:Name="ChartCanvas"
                      HeightRequest="300"
                      Drawable="{Binding ChartDrawable}"
                      BackgroundColor="Transparent"
                      Grid.Row="2">
                        <GraphicsView.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnChartTapped" />
                        </GraphicsView.GestureRecognizers>
                    </GraphicsView>

                </Grid>
            </Border>



            <BoxView HeightRequest="80" Opacity="0" />




        </VerticalStackLayout>

    </ScrollView>

</ContentPage>
