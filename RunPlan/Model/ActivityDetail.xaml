<ContentPage
    x:Class="RunPlan.Model.ActivityDetail"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodel="clr-namespace:RunPlan.ViewModel"
    xmlns:converters="clr-namespace:RunPlan.Converters"
    x:DataType="viewmodel:DetailViewModel"
    Title="Activity Detail"
    BackgroundColor="#8260DA">

    
    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>



    <ScrollView>
		<VerticalStackLayout Padding="20" Spacing="20">
            <Grid ColumnDefinitions="Auto,*,Auto" Padding="0,0,0,10">
                <!-- Back Button -->
                <ImageButton Source="back.png"
						 Clicked="OnBackClicked"
						 BackgroundColor="Transparent"
						 HorizontalOptions="Start"
						 HeightRequest="30"
						 WidthRequest="30"    
						 Grid.Column="0"/>
                <!-- Save Button (only when editing) -->
                <Button Text="Save"
						FontSize="14"
						BackgroundColor="White"
						TextColor="MediumPurple"
						CornerRadius="10"
						Command="{Binding SaveChangesCommand}"
						IsVisible="{Binding IsEditing}"
						Grid.Column="2" />

                <ImageButton Source="edit.png"
							 Command="{Binding EditCommand}"
							 BackgroundColor="Transparent"
							 HorizontalOptions="End"
							 HeightRequest="30"
							 WidthRequest="30"    
							 Grid.Column="1"/>
            </Grid>

            <!-- Title -->
            <StackLayout Spacing="5">
                <!-- View Mode -->
                <Label Text="{Binding RunningActivity.Name}"
					   FontSize="32"
					   FontAttributes="Bold"
					   TextColor="White"
					   HorizontalOptions="Center"
					   IsVisible="{Binding IsEditing, Converter={StaticResource InverseBoolConverter}}" />

                <!-- Edit Mode -->
                <Entry Text="{Binding RunningActivity.Name, Mode=TwoWay}"
					   FontSize="32"
					   TextColor="White"
					   FontAttributes="Bold"
					   HorizontalOptions="Center"
					   IsVisible="{Binding IsEditing}" />
            </StackLayout>

            <!-- Info Grid (2x2 Boxes) -->
			<Grid ColumnDefinitions="Auto,Auto" RowDefinitions="Auto,Auto" ColumnSpacing="20" RowSpacing="20" HorizontalOptions ="Center">

				<!-- Distance Box -->
				<Frame Grid.Row="0" Grid.Column="0"
					   BackgroundColor="#4E3689"
					   CornerRadius="12"
					   BorderColor="#4E3689"
					   HeightRequest="150"
					   WidthRequest="180"
					   HorizontalOptions="Center"
					   VerticalOptions="Center"
					   Padding="0"
					   HasShadow="False">
					<Grid VerticalOptions="Center" HorizontalOptions="Center">

                        <!-- View Mode -->
                        <Label HorizontalTextAlignment="Center"
							   VerticalTextAlignment="Center"
							   TextColor="White"
                               IsVisible="{Binding IsEditing, Converter={StaticResource InverseBoolConverter}}">
							<Label.FormattedText>
								<FormattedString>
									<Span Text="{Binding Distance}" FontSize="36" FontAttributes="Bold" />
									<Span Text=" km" FontSize="18" />
								</FormattedString>
							</Label.FormattedText>
						</Label>

                        <!-- Edit Mode -->
                        <VerticalStackLayout IsVisible="{Binding IsEditing}">
                            <Entry Text="{Binding RunningActivity.Distance, Mode=TwoWay}"
								   FontSize="36"
								   WidthRequest="100"
								   Keyboard="Numeric"
								   HorizontalTextAlignment="Center"
								   TextColor="White"
								   BackgroundColor="Transparent" />
											<Label Text="km"
								   FontSize="18"
								   TextColor="White"
								   HorizontalOptions="Center" />
                        </VerticalStackLayout>


                    </Grid>
				</Frame>

				
			
				<!-- Time Box -->
				<Frame Grid.Row="0" Grid.Column="1"
					   BackgroundColor="#4E3689"
					   CornerRadius="12"
					   BorderColor="#4E3689"
					   HeightRequest="150"
					   WidthRequest="180"
					   HorizontalOptions="Center"
					   VerticalOptions="Center"
					   Padding="0"
					   HasShadow="False">

					<Grid VerticalOptions="Center" HorizontalOptions="Center">

                        <!-- View Mode -->
                        <Label HorizontalTextAlignment="Center"
							   VerticalTextAlignment="Center"
							   TextColor="White"
                               IsVisible="{Binding IsEditing, Converter={StaticResource InverseBoolConverter}}">
							<Label.FormattedText>
								<FormattedString>
									<Span Text="{Binding Time}" FontSize="36" FontAttributes="Bold" />
									<Span Text=" min" FontSize="18" />
								</FormattedString>
							</Label.FormattedText>
						</Label>

                        <!-- Edit Mode -->
                        <VerticalStackLayout IsVisible="{Binding IsEditing}" Spacing="8" HorizontalOptions="Center">
                            <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                                <!-- Hours -->
                                <VerticalStackLayout Spacing="2">
                                    <Picker ItemsSource="{Binding HourOptions}"
											SelectedItem="{Binding SelectedHour}"
											WidthRequest="60"
											TextColor="White"
											BackgroundColor="Transparent" />
                                    <Label Text="hh" FontSize="14" TextColor="White" HorizontalOptions="Center"/>
                                </VerticalStackLayout>

                                <!-- Minutes -->
                                <VerticalStackLayout Spacing="2">
                                    <Picker ItemsSource="{Binding MinuteOptions}"
											SelectedItem="{Binding SelectedMinute}"
											WidthRequest="60"
											TextColor="White"
											BackgroundColor="Transparent" />
                                    <Label Text="mm" FontSize="14" TextColor="White" HorizontalOptions="Center"/>
                                </VerticalStackLayout>

                                <!-- Seconds -->
                                <VerticalStackLayout Spacing="2">
                                    <Picker ItemsSource="{Binding SecondOptions}"
											SelectedItem="{Binding SelectedSecond}"
											WidthRequest="60"
											TextColor="White"
											BackgroundColor="Transparent" />
                                    <Label Text="ss" FontSize="14" TextColor="White" HorizontalOptions="Center"/>
                                </VerticalStackLayout>
                            </HorizontalStackLayout>

                            <!-- Optional: Display full formatted duration -->
                            <Label Text="{Binding CombinedDuration}"
								   TextColor="White"
								   FontSize="14"
								   HorizontalOptions="Center"/>
                        </VerticalStackLayout>


                    </Grid>
				</Frame>


				<!-- Pace Box -->
				<Frame Grid.Row="1" Grid.Column="0"
					   BackgroundColor="#4E3689"
					   CornerRadius="12"
					   BorderColor="#4E3689"
					   HeightRequest="150"
					   WidthRequest="180"
					   HorizontalOptions="Center"
					   VerticalOptions="Center"
					   Padding="0"
					   HasShadow="False">

                    <Grid VerticalOptions="Center" HorizontalOptions="Center">
                        <Label HorizontalTextAlignment="Center"
							   VerticalTextAlignment="Center"
							   TextColor="White">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding Pace, StringFormat='{0}'}" FontSize="36" FontAttributes="Bold" />
                                    <Span Text="min/km" FontSize="18" />
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </Grid>
				</Frame>





				<!-- Grade box -->
				<Frame Grid.Row="1" Grid.Column="1"
					   BackgroundColor="#4E3689"
					   CornerRadius="12"
					   BorderColor="#4E3689"
					   HeightRequest="150"
					   WidthRequest="180"
					   HorizontalOptions="Center"
					   VerticalOptions="Center"
					   Padding="0"
					   HasShadow="False">

					<Grid VerticalOptions="Center" HorizontalOptions="Center">
                        <!-- View Mode -->
                        <Label HorizontalTextAlignment="Center"
							   VerticalTextAlignment="Center"
							   TextColor="White"
                               IsVisible="{Binding IsEditing, Converter={StaticResource InverseBoolConverter}}">
                            <Label.FormattedText>
								<FormattedString>
									<Span Text="{Binding Grade}" FontSize="36" FontAttributes="Bold" />
									<Span Text="" FontSize="18" />
								</FormattedString>
							</Label.FormattedText>
						</Label>

                        <!-- Edit Mode -->
                        <VerticalStackLayout IsVisible="{Binding IsEditing}">
                            <Entry Text="{Binding RunningActivity.Grade, Mode=TwoWay}"
								   FontSize="36"
								   WidthRequest="100"
								   Keyboard="Text"
								   HorizontalTextAlignment="Center"
								   TextColor="White"
								   BackgroundColor="Transparent" />
                            <Label Text=""
								   FontSize="18"
								   TextColor="White"
								   HorizontalOptions="Center" />
                        </VerticalStackLayout>




                    </Grid>
				</Frame>




			</Grid>

			<!-- Description -->
			<Frame BackgroundColor="White"
                   CornerRadius="15"
                   Padding="20"
				   WidthRequest="390"
                   HasShadow="False"
                   VerticalOptions="Start">
                
                <VerticalStackLayout Spacing="10">
                    <!-- View Mode -->
                    <Label Text="{Binding Description}"
                       TextColor="#4E3689"
                       FontSize="16" 
                       LineBreakMode="WordWrap"
                       VerticalOptions="Start"
                       IsVisible="{Binding IsEditing, Converter={StaticResource InverseBoolConverter}}"/>
                    
                    <!-- Edit Mode -->
                    <Editor Text="{Binding RunningActivity.Description}"
							TextColor="#4E3689"
							FontSize="16"
							IsVisible="{Binding IsEditing}"
							AutoSize="TextChanges"
							HeightRequest="100"
							BackgroundColor="Transparent"
                            VerticalOptions="StartAndExpand"/>
                </VerticalStackLayout>
            </Frame>

		</VerticalStackLayout>
	</ScrollView>
</ContentPage>
